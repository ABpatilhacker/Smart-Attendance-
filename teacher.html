<!DOCTYPE html>
<html>
<head>
  <title>Teacher Dashboard</title>
  <link rel="stylesheet" href="style.css">

  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
  <script src="firebase.js"></script>
</head>
<body>

<div class="navbar">
  <h1>ğŸ‘¨â€ğŸ« Teacher Dashboard</h1>
</div>

<div class="container">

  <!-- Add Class -->
  <div class="card">
    <h3>Create Class</h3>
    <input id="className" placeholder="Class Name">
    <button class="btn btn-primary" onclick="addClass()">Add Class</button>
  </div>

  <!-- Add Student -->
  <div class="card">
    <h3>Add Student</h3>
    <input id="studentName" placeholder="Student Name">
    <input id="rollNo" placeholder="Roll Number">
    <button class="btn btn-success" onclick="addStudent()">Add Student</button>
  </div>

  <!-- Attendance -->
  <div class="card">
    <h3>Take Attendance</h3>
    <div id="studentList"></div>
  </div>

</div>

<script>
let teacherId;
let currentClass = "";

firebase.auth().onAuthStateChanged(user => {
  if (!user) location.href = "login.html";
  teacherId = user.uid;
});

function addClass() {
  currentClass = className.value;
  database.ref(`teachers/${teacherId}/classes/${currentClass}`).set({
    created: true
  });
  alert("Class Added");
}

function addStudent() {
  database.ref(`teachers/${teacherId}/classes/${currentClass}/students/${rollNo.value}`)
    .set(studentName.value);
  loadStudents();
}

function loadStudents() {
  studentList.innerHTML = "";
  database.ref(`teachers/${teacherId}/classes/${currentClass}/students`)
    .once("value", snap => {
      snap.forEach(s => {
        studentList.innerHTML += `
          <div class="list-item">
            ${s.key} - ${s.val()}
            <div>
              <button class="btn btn-success" onclick="mark('${s.key}','present')">P</button>
              <button class="btn btn-danger" onclick="mark('${s.key}','absent')">A</button>
            </div>
          </div>
        `;
      });
    });
}

function mark(roll, status) {
  const date = new Date().toISOString().split("T")[0];
  database.ref(`teachers/${teacherId}/classes/${currentClass}/attendance/${date}/${roll}`)
    .set(status);
}
</script>

</body>
</html>
