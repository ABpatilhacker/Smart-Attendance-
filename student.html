<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Student Dashboard</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
<script src="firebase.js"></script>
</head>
<body>
<header>
<h1>ğŸ‘¨â€ğŸ“ Student Dashboard</h1>
<button class="btn logout" onclick="signOutUser()">Logout</button>
</header>
<div class="dashboard-container">
<h2>Attendance</h2>
<div id="attendanceList"></div>
</div>

<script>
let studentUID="";
auth.onAuthStateChanged(user=>{
  if(!user) window.location="login.html";
  else studentUID=user.uid;
  loadAttendance();
});

function signOutUser(){ auth.signOut().then(()=>window.location="login.html"); }

function loadAttendance(){
  const attDiv = document.getElementById("attendanceList");
  attDiv.innerHTML="";
  database.ref("teachers").once("value").then(snap=>{
    snap.forEach(t=>{
      const classes = t.val().classes;
      for(let c in classes){
        const students = classes[c].students;
        if(students && students[studentUID]){
          const att = classes[c].attendance;
          let present=0,total=0;
          for(let date in att){
            total++;
            if(att[date][studentUID]=="present") present++;
          }
          attDiv.innerHTML += `<p>${c}: ${present}/${total} present (${total? Math.round(present/total*100):0}%)</p>`;
        }
      }
    });
  });
}
</script>
</body>
</html>